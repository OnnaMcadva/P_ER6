# P_ER6

![Screenshot from 2025-05-05 13-50-08](https://github.com/user-attachments/assets/ac3ac337-ec65-4df3-9d5e-1246c2ad10b1)


![Screenshot from 2025-05-05 13-52-21](https://github.com/user-attachments/assets/310795e0-2f45-4265-a8c3-f983c6d2523b)


---

1. **Подготовка и запуск сервера:**

   * Программа принимает один аргумент — номер порта.
   * Создаёт серверный сокет, привязывает его к `127.0.0.1:<порт>`, переводит в режим прослушивания соединений (`listen()`).
   * Инициализирует множества дескрипторов (`fd_set`) для `select()`.

2. **Главный цикл:**

   * Копирует список активных сокетов в множества на чтение и запись (`rfds`, `wfds`).
   * Вызывает `select()` — блокируется, пока не появится активность на одном из сокетов.

3. **Обработка активности:**

   * Если сработал **серверный сокет**, это означает, что пришло новое соединение:

     * Вызывается `accept()`, создаётся новый клиентский сокет.
     * К нему присваивается уникальный ID, он добавляется в список активных соединений.
     * Всем остальным клиентам отправляется сообщение: "client X just arrived".

   * Если сработал **клиентский сокет**, это означает, что клиент что-то прислал:

     * Данные читаются в буфер. Если клиент отключился, его удаляют.
     * Если данные получены, они добавляются в буфер клиента.
     * Программа извлекает отдельные сообщения (по `\n`) и рассылает их всем другим клиентам в формате:
       `client X: сообщение`.

4. **Удаление клиента:**

   * Если клиент отключился (`recv() <= 0`), он удаляется.
   * Всем остальным клиентам отправляется сообщение: "client X just left".

---


if (socket(...) == -1) err("Fatal error\n");
if (bind(...) == -1) err("Fatal error\n");
if (listen(...) == -1) err("Fatal error\n");
if (select(...) == -1) err("Fatal error\n");
if (accept(...) == -1) continue; // не фатально
if (send(...) == -1) err("Fatal error\n");
if (recv(...) <= 0) disconnect();
